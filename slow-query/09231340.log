
# 22s user time, 60ms system time, 33.48M rss, 40.61M vsz
# Current date: Sat Sep 23 13:40:22 2023
# Hostname: ubuntu
# Files: mysql-slow.log
# Overall: 314.80k total, 79 unique, 3.62k QPS, 4.21x concurrency ________
# Time range: 2023-09-23T04:36:27 to 2023-09-23T04:37:54
# Attribute          total     min     max     avg     95%  stddev  median
# ============     ======= ======= ======= ======= ======= ======= =======
# Exec time           366s     1us      1s     1ms     3ms    11ms    73us
# Lock time          537ms       0    88ms     1us     1us   203us       0
# Rows sent        177.71k       0      50    0.58    0.99    3.28       0
# Rows examine       1.56M       0  18.25k    5.20    1.96  136.88       0
# Query size        23.30M       6 632.12k   77.62  284.79   1.56k   31.70

# Profile
# Rank Query ID                     Response time  Calls  R/Call V/M   Ite
# ==== ============================ ============== ====== ====== ===== ===
#    1 0xFFFCA4D67EA0A788813031B... 270.7793 73.9%  20679 0.0131  0.13 COMMIT
#    2 0xDA556F9115773A1A99AA016...  24.1324  6.6%  91030 0.0003  0.00 ADMIN PREPARE
#    3 0x2BC75A9C3EB65F1EC570DFB...   5.0419  1.4%   2585 0.0020  0.01 SELECT announcements courses registrations unread_announcements
#    4 0x98DD1BA507AB79261637698...   4.6932  1.3%   4737 0.0010  0.01 INSERT UPDATE submissions
#    5 0x27543A651E60736B5044388...   4.6716  1.3%   6635 0.0007  0.01 UPDATE unread_announcements
#    6 0xDAFB520F3EA62E0FD8FCB26...   4.4981  1.2%    282 0.0160  0.02 INSERT courses
#    7 0xA9A13C7DE4DE6522B8635F3...   3.9772  1.1%   1226 0.0032  0.01 SELECT users registrations courses classes submissions
#    8 0x34680D6218DB2F97EAE350D...   3.9544  1.1%   6837 0.0006  0.02 INSERT unread_announcements
#    9 0xF16955B9A50074ED04E1B8A...   3.9497  1.1%   6637 0.0006  0.01 SELECT announcements courses unread_announcements
#   10 0xAE994A27799DADD410E8483...   3.8335  1.0%   4776 0.0008  0.01 SELECT classes submissions
# MISC 0xMISC                        36.7614 10.0% 169378 0.0002   0.0 <69 ITEMS>

# Query 1: 243.28 QPS, 3.19x concurrency, ID 0xFFFCA4D67EA0A788813031B8BBC3B329 at byte 56234233
# Scores: V/M = 0.13
# Time range: 2023-09-23T04:36:29 to 2023-09-23T04:37:54
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          6   20679
# Exec time     73    271s    13us      1s    13ms    51ms    42ms     5ms
# Lock time      0       0       0       0       0       0       0       0
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size     0 121.17k       6       6       6       6       0       6
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  ##########################################
# 100us  ###############
#   1ms  ################################################################
#  10ms  ###########################################
# 100ms  #
#    1s  #
#  10s+
COMMIT\G

# Query 2: 1.07k QPS, 0.28x concurrency, ID 0xDA556F9115773A1A99AA0165670CE848 at byte 6793890
# Scores: V/M = 0.00
# Time range: 2023-09-23T04:36:29 to 2023-09-23T04:37:54
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         28   91030
# Exec time      6     24s    21us   110ms   265us   972us     1ms    84us
# Lock time      0       0       0       0       0       0       0       0
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size    11   2.60M      30      30      30      30       0      30
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  ##########################################
#   1ms  #####
#  10ms  #
# 100ms  #
#    1s
#  10s+
administrator command: Prepare\G

# Query 3: 31.52 QPS, 0.06x concurrency, ID 0x2BC75A9C3EB65F1EC570DFB4E3F111C5 at byte 80496161
# Scores: V/M = 0.01
# Time range: 2023-09-23T04:36:32 to 2023-09-23T04:37:54
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    2585
# Exec time      1      5s   136us    62ms     2ms     7ms     4ms   799us
# Lock time      3    21ms     1us     6ms     8us     3us   128us     1us
# Rows sent     24  42.80k       0      21   16.96   20.43    7.38   20.43
# Rows examine  17 273.07k       0     614  108.17  313.99   93.12   80.10
# Query size     6   1.51M     611     613  611.17  592.07       0  592.07
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ################################################################
#   1ms  ##############################################
#  10ms  ###
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'announcements'\G
#    SHOW CREATE TABLE `isucholar`.`announcements`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'courses'\G
#    SHOW CREATE TABLE `isucholar`.`courses`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'registrations'\G
#    SHOW CREATE TABLE `isucholar`.`registrations`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'unread_announcements'\G
#    SHOW CREATE TABLE `isucholar`.`unread_announcements`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT `announcements`.`id`, `courses`.`id` AS `course_id`, `courses`.`name` AS `course_name`, `announcements`.`title`, NOT `unread_announcements`.`is_deleted` AS `unread` FROM `announcements` JOIN `courses` ON `announcements`.`course_id` = `courses`.`id` JOIN `registrations` ON `courses`.`id` = `registrations`.`course_id` JOIN `unread_announcements` ON `announcements`.`id` = `unread_announcements`.`announcement_id` WHERE 1=1 AND `unread_announcements`.`user_id` = '01FF6J8XKSTXBHB7CM60YMCTBQ' AND `registrations`.`user_id` = '01FF6J8XKSTXBHB7CM60YMCTBQ' ORDER BY `announcements`.`id` DESC LIMIT 21 OFFSET 0\G

# Query 4: 72.88 QPS, 0.07x concurrency, ID 0x98DD1BA507AB79261637698A8004A814 at byte 46395412
# Scores: V/M = 0.01
# Time range: 2023-09-23T04:36:29 to 2023-09-23T04:37:34
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1    4737
# Exec time      1      5s    70us    73ms   990us     3ms     4ms   214us
# Lock time     17    95ms       0    72ms    20us     1us     1ms     1us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size     4   1.02M     202     316  225.89  258.32   25.94  212.52
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  #############
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'submissions'\G
#    SHOW CREATE TABLE `isucholar`.`submissions`\G
INSERT INTO `submissions` (`user_id`, `class_id`, `file_name`) VALUES ('01FF6J8XVG047H135C9WX1Z74K', '01HB05773R6CZ6KMDGSEGY1Z24', 'S03099.pdf') ON DUPLICATE KEY UPDATE `file_name` = VALUES(`file_name`)\G

# Query 5: 103.67 QPS, 0.07x concurrency, ID 0x27543A651E60736B50443886E289E35A at byte 34511553
# Scores: V/M = 0.01
# Time range: 2023-09-23T04:36:30 to 2023-09-23T04:37:34
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          2    6635
# Exec time      1      5s    79us    57ms   704us     2ms     2ms   224us
# Lock time      4    23ms       0     4ms     3us     1us    56us     1us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0   6.48k       1       1       1       1       0       1
# Query size     4 991.36k     153     153     153     153       0     153
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  ############
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'unread_announcements'\G
#    SHOW CREATE TABLE `isucholar`.`unread_announcements`\G
UPDATE `unread_announcements` SET `is_deleted` = true WHERE `announcement_id` = '01HB057283PTPNZY2J94T68P7A' AND `user_id` = '01FF6J8XQCA0BNNVRMRWDJRX3G'\G
# Converted for EXPLAIN
# EXPLAIN /*!50100 PARTITIONS*/
select  `is_deleted` = true from `unread_announcements` where  `announcement_id` = '01HB057283PTPNZY2J94T68P7A' AND `user_id` = '01FF6J8XQCA0BNNVRMRWDJRX3G'\G

# Query 6: 4.34 QPS, 0.07x concurrency, ID 0xDAFB520F3EA62E0FD8FCB26DC5D1E62F at byte 10050458
# Scores: V/M = 0.02
# Time range: 2023-09-23T04:36:29 to 2023-09-23T04:37:34
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0     282
# Exec time      1      4s   814us    93ms    16ms    56ms    19ms     8ms
# Lock time      0     2ms     1us   833us     7us     2us    60us     1us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size     0 115.83k     362     484  420.62  441.81   24.67  400.73
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  #
#   1ms  ################################################################
#  10ms  #########################################
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'courses'\G
#    SHOW CREATE TABLE `isucholar`.`courses`\G
INSERT INTO `courses` (`id`, `code`, `type`, `name`, `description`, `credit`, `period`, `day_of_week`, `teacher_id`, `keywords`) VALUES ('01HB056FRV7RA5WHAMPEPQ4WT0', 'M0060', 'major-subjects', 'アルゴリズム設計演習', '本講義では出席をランダムな講義回で取る。成績は出席と課題の提出状況により判断する。', 1, 2, 'tuesday', '01FF6J8XFYRVJYCAZ82EQ6JEY5', 'アルゴリズム 設計')\G

# Query 7: 15.32 QPS, 0.05x concurrency, ID 0xA9A13C7DE4DE6522B8635F3933142DB1 at byte 81143656
# Scores: V/M = 0.01
# Time range: 2023-09-23T04:36:29 to 2023-09-23T04:37:49
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    1226
# Exec time      1      4s   184us    40ms     3ms    12ms     4ms     2ms
# Lock time      1     7ms     1us   633us     5us     2us    30us     1us
# Rows sent     22  40.19k       1      50   33.57   49.17   18.61   38.53
# Rows examine  26 423.23k       4     698  353.50  685.39  287.19  202.40
# Query size     2 538.77k     450     450     450     450       0     450
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ################################################
#   1ms  ################################################################
#  10ms  ##########
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'users'\G
#    SHOW CREATE TABLE `isucholar`.`users`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'registrations'\G
#    SHOW CREATE TABLE `isucholar`.`registrations`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'courses'\G
#    SHOW CREATE TABLE `isucholar`.`courses`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'classes'\G
#    SHOW CREATE TABLE `isucholar`.`classes`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'submissions'\G
#    SHOW CREATE TABLE `isucholar`.`submissions`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT IFNULL(SUM(`submissions`.`score`), 0) AS `total_score` FROM `users` JOIN `registrations` ON `users`.`id` = `registrations`.`user_id` JOIN `courses` ON `registrations`.`course_id` = `courses`.`id` LEFT JOIN `classes` ON `courses`.`id` = `classes`.`course_id` LEFT JOIN `submissions` ON `users`.`id` = `submissions`.`user_id` AND `submissions`.`class_id` = `classes`.`id` WHERE `courses`.`id` = '01HB056EFEC0X4AANDH5QPPXBY' GROUP BY `users`.`id`\G

# Query 8: 105.18 QPS, 0.06x concurrency, ID 0x34680D6218DB2F97EAE350D366B60E94 at byte 34499219
# Scores: V/M = 0.02
# Time range: 2023-09-23T04:36:29 to 2023-09-23T04:37:34
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          2    6837
# Exec time      1      4s    59us    56ms   578us     1ms     3ms   119us
# Lock time      3    16ms       0     1ms     2us     1us    30us     1us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size     3 888.01k     133     133     133     133       0     133
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  ############################
# 100us  ################################################################
#   1ms  ######
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'unread_announcements'\G
#    SHOW CREATE TABLE `isucholar`.`unread_announcements`\G
INSERT INTO `unread_announcements` (`announcement_id`, `user_id`) VALUES ('01HB05737EGP73X7QP3Z30EQG7', '01FF6J8XKCEP2ZV3BN2X76B4XY')\G

# Query 9: 103.70 QPS, 0.06x concurrency, ID 0xF16955B9A50074ED04E1B8A511E35989 at byte 79947863
# Scores: V/M = 0.01
# Time range: 2023-09-23T04:36:30 to 2023-09-23T04:37:34
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          2    6637
# Exec time      1      4s    77us    60ms   595us     2ms     2ms   176us
# Lock time      7    43ms       0     3ms     6us     2us    64us     1us
# Rows sent      3   6.48k       0       1    1.00    0.99    0.02    0.99
# Rows examine   0   6.48k       0       1    1.00    0.99    0.02    0.99
# Query size    13   3.18M     503     503     503     503       0     503
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  ##
# 100us  ################################################################
#   1ms  #########
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'announcements'\G
#    SHOW CREATE TABLE `isucholar`.`announcements`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'courses'\G
#    SHOW CREATE TABLE `isucholar`.`courses`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'unread_announcements'\G
#    SHOW CREATE TABLE `isucholar`.`unread_announcements`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT `announcements`.`id`, `courses`.`id` AS `course_id`, `courses`.`name` AS `course_name`, `announcements`.`title`, `announcements`.`message`, NOT `unread_announcements`.`is_deleted` AS `unread` FROM `announcements` JOIN `courses` ON `courses`.`id` = `announcements`.`course_id` JOIN `unread_announcements` ON `unread_announcements`.`announcement_id` = `announcements`.`id` WHERE `announcements`.`id` = '01HB05739T5QGBWCEW98AAP5FB' AND `unread_announcements`.`user_id` = '01FF6J8XW3RJMTE6XXFH55WDZN'\G

# Query 10: 73.48 QPS, 0.06x concurrency, ID 0xAE994A27799DADD410E848351C4DFF53 at byte 50938492
# Scores: V/M = 0.01
# Time range: 2023-09-23T04:36:29 to 2023-09-23T04:37:34
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1    4776
# Exec time      1      4s   110us    51ms   802us     3ms     2ms   260us
# Lock time      3    20ms       0     3ms     4us     2us    55us     1us
# Rows sent      6  12.13k       1       5    2.60    4.96    1.42    1.96
# Rows examine   1  18.01k       1       9    3.86    8.91    2.56    2.90
# Query size     5   1.36M     298     298     298     298       0     298
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ################################################################
#   1ms  ##############
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'classes'\G
#    SHOW CREATE TABLE `isucholar`.`classes`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'submissions'\G
#    SHOW CREATE TABLE `isucholar`.`submissions`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT `classes`.*, `submissions`.`user_id` IS NOT NULL AS `submitted` FROM `classes` LEFT JOIN `submissions` ON `classes`.`id` = `submissions`.`class_id` AND `submissions`.`user_id` = '01FF6J8XYTRZFG401C6J7FA7AA' WHERE `classes`.`course_id` = '01HB056EJRR4AB7RFM0Q5JYDAW' ORDER BY `classes`.`part`\G
