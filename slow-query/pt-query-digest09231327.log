
# 22.6s user time, 80ms system time, 33.46M rss, 40.61M vsz
# Current date: Sat Sep 23 13:27:25 2023
# Hostname: ubuntu
# Files: mysql-slow.log
# Overall: 324.37k total, 78 unique, 3.73k QPS, 4.34x concurrency ________
# Time range: 2023-09-23T04:09:18 to 2023-09-23T04:10:45
# Attribute          total     min     max     avg     95%  stddev  median
# ============     ======= ======= ======= ======= ======= ======= =======
# Exec time           378s     1us      2s     1ms     3ms    12ms    73us
# Lock time          454ms       0    42ms     1us     1us    99us       0
# Rows sent        187.47k       0      50    0.59    0.99    3.35       0
# Rows examine       1.80M       0  18.42k    5.81    1.96  159.89       0
# Query size        23.80M       6 632.12k   76.95  284.79   1.54k   31.70

# Profile
# Rank Query ID                     Response time  Calls  R/Call V/M   Ite
# ==== ============================ ============== ====== ====== ===== ===
#    1 0xFFFCA4D67EA0A788813031B... 278.3920 73.7%  20113 0.0138  0.15 COMMIT
#    2 0xDA556F9115773A1A99AA016...  24.3334  6.4%  94589 0.0003  0.00 ADMIN PREPARE
#    3 0xA9A13C7DE4DE6522B8635F3...   6.0267  1.6%   1544 0.0039  0.01 SELECT users registrations courses classes submissions
#    4 0xDAFB520F3EA62E0FD8FCB26...   4.8157  1.3%    330 0.0146  0.05 INSERT courses
#    5 0x8082220C07E2A565D306665...   4.7720  1.3%     46 0.1037  0.05 SELECT users registrations courses registrations courses classes submissions
#    6 0x34680D6218DB2F97EAE350D...   4.6443  1.2%   7287 0.0006  0.02 INSERT unread_announcements
#    7 0x27543A651E60736B5044388...   4.5314  1.2%   6584 0.0007  0.00 UPDATE unread_announcements
#    8 0x2BC75A9C3EB65F1EC570DFB...   4.0543  1.1%   2304 0.0018  0.01 SELECT announcements courses registrations unread_announcements
#    9 0xAE994A27799DADD410E8483...   4.0034  1.1%   4464 0.0009  0.01 SELECT classes submissions
#   10 0xF16955B9A50074ED04E1B8A...   3.6591  1.0%   6586 0.0006  0.01 SELECT announcements courses unread_announcements
# MISC 0xMISC                        38.3808 10.2% 180522 0.0002   0.0 <68 ITEMS>

# Query 1: 236.62 QPS, 3.28x concurrency, ID 0xFFFCA4D67EA0A788813031B8BBC3B329 at byte 64164829
# Scores: V/M = 0.15
# Time range: 2023-09-23T04:09:20 to 2023-09-23T04:10:45
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          6   20113
# Exec time     73    278s    13us      2s    14ms    51ms    46ms     5ms
# Lock time      0       0       0       0       0       0       0       0
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size     0 117.85k       6       6       6       6       0       6
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  #####################################
# 100us  ##############
#   1ms  ################################################################
#  10ms  ##########################################
# 100ms  #
#    1s  #
#  10s+
COMMIT\G

# Query 2: 1.11k QPS, 0.29x concurrency, ID 0xDA556F9115773A1A99AA0165670CE848 at byte 69135881
# Scores: V/M = 0.00
# Time range: 2023-09-23T04:09:20 to 2023-09-23T04:10:45
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         29   94589
# Exec time      6     24s    19us    40ms   257us   972us   580us    84us
# Lock time      0       0       0       0       0       0       0       0
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size    11   2.71M      30      30      30      30       0      30
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  ############################################
#   1ms  #####
#  10ms  #
# 100ms
#    1s
#  10s+
administrator command: Prepare\G

# Query 3: 19.30 QPS, 0.08x concurrency, ID 0xA9A13C7DE4DE6522B8635F3933142DB1 at byte 77900839
# Scores: V/M = 0.01
# Time range: 2023-09-23T04:09:20 to 2023-09-23T04:10:40
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    1544
# Exec time      1      6s   179us    37ms     4ms    14ms     5ms     2ms
# Lock time      1     8ms     1us   770us     5us     2us    35us     1us
# Rows sent     25  48.54k       2      50   32.19   49.17   18.36   34.95
# Rows examine  28 527.62k       7     695  349.92  652.75  285.57  212.52
# Query size     2 678.52k     450     450     450     450       0     450
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  #############################################
#   1ms  ################################################################
#  10ms  #################
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'users'\G
#    SHOW CREATE TABLE `isucholar`.`users`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'registrations'\G
#    SHOW CREATE TABLE `isucholar`.`registrations`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'courses'\G
#    SHOW CREATE TABLE `isucholar`.`courses`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'classes'\G
#    SHOW CREATE TABLE `isucholar`.`classes`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'submissions'\G
#    SHOW CREATE TABLE `isucholar`.`submissions`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT IFNULL(SUM(`submissions`.`score`), 0) AS `total_score` FROM `users` JOIN `registrations` ON `users`.`id` = `registrations`.`user_id` JOIN `courses` ON `registrations`.`course_id` = `courses`.`id` LEFT JOIN `classes` ON `courses`.`id` = `classes`.`course_id` LEFT JOIN `submissions` ON `users`.`id` = `submissions`.`user_id` AND `submissions`.`class_id` = `classes`.`id` WHERE `courses`.`id` = '01HB03MQW5EE54HC9C1239P7FY' GROUP BY `users`.`id`\G

# Query 4: 5.08 QPS, 0.07x concurrency, ID 0xDAFB520F3EA62E0FD8FCB26DC5D1E62F at byte 64129410
# Scores: V/M = 0.05
# Time range: 2023-09-23T04:09:20 to 2023-09-23T04:10:25
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0     330
# Exec time      1      5s     2ms   409ms    15ms    46ms    27ms     7ms
# Lock time      0     2ms     1us     1ms     7us     2us    73us     1us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size     0 134.78k     362     481  418.22  441.81   23.96  400.73
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us
#   1ms  ################################################################
#  10ms  #############################
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'courses'\G
#    SHOW CREATE TABLE `isucholar`.`courses`\G
INSERT INTO `courses` (`id`, `code`, `type`, `name`, `description`, `credit`, `period`, `day_of_week`, `teacher_id`, `keywords`) VALUES ('01HB03P348X30CS78CGZXCGWMY', 'L0052', 'liberal-arts', '政治史第一', '本講義では課題提出をもって出席の代わりとする。成績は出席と課題の提出状況により判断する。', 2, 3, 'friday', '01FF6J8XFT5643KX590YXYAQCE', '政治 史')\G

# Query 5: 0.57 QPS, 0.06x concurrency, ID 0x8082220C07E2A565D306665B3BC827B4 at byte 88971153
# Scores: V/M = 0.05
# Time range: 2023-09-23T04:09:20 to 2023-09-23T04:10:40
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0      46
# Exec time      1      5s   357us   204ms   104ms   180ms    71ms   141ms
# Lock time      0   242us     2us   119us     5us     3us    16us     2us
# Rows sent      0   1.66k       0      50   37.04   49.17   21.45   49.17
# Rows examine  27 511.09k      88  18.42k  11.11k  17.59k   6.50k  14.47k
# Query size     0  38.36k     854     854     854     854       0     854
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  #################
#   1ms  ########
#  10ms  ###########
# 100ms  ################################################################
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'users'\G
#    SHOW CREATE TABLE `isucholar`.`users`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'registrations'\G
#    SHOW CREATE TABLE `isucholar`.`registrations`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'courses'\G
#    SHOW CREATE TABLE `isucholar`.`courses`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'classes'\G
#    SHOW CREATE TABLE `isucholar`.`classes`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'submissions'\G
#    SHOW CREATE TABLE `isucholar`.`submissions`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT IFNULL(SUM(`submissions`.`score` * `courses`.`credit`), 0) / 100 / `credits`.`credits` AS `gpa` FROM `users` JOIN (     SELECT `users`.`id` AS `user_id`, SUM(`courses`.`credit`) AS `credits`     FROM `users`     JOIN `registrations` ON `users`.`id` = `registrations`.`user_id`     JOIN `courses` ON `registrations`.`course_id` = `courses`.`id` AND `courses`.`status` = 'closed'     GROUP BY `users`.`id` ) AS `credits` ON `credits`.`user_id` = `users`.`id` JOIN `registrations` ON `users`.`id` = `registrations`.`user_id` JOIN `courses` ON `registrations`.`course_id` = `courses`.`id` AND `courses`.`status` = 'closed' LEFT JOIN `classes` ON `courses`.`id` = `classes`.`course_id` LEFT JOIN `submissions` ON `users`.`id` = `submissions`.`user_id` AND `submissions`.`class_id` = `classes`.`id` WHERE `users`.`type` = 'student' GROUP BY `users`.`id`\G

# Query 6: 110.41 QPS, 0.07x concurrency, ID 0x34680D6218DB2F97EAE350D366B60E94 at byte 37909613
# Scores: V/M = 0.02
# Time range: 2023-09-23T04:09:20 to 2023-09-23T04:10:26
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          2    7287
# Exec time      1      5s    53us   102ms   637us     2ms     4ms   119us
# Lock time      5    23ms       0     3ms     3us     1us    58us     1us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size     3 946.46k     133     133     133     133       0     133
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  ##################################
# 100us  ################################################################
#   1ms  ########
#  10ms  #
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'unread_announcements'\G
#    SHOW CREATE TABLE `isucholar`.`unread_announcements`\G
INSERT INTO `unread_announcements` (`announcement_id`, `user_id`) VALUES ('01HB03NFD3NA2JBXPNG6ACG4CR', '01FF6J8XP3ZBKH29JWT2D5R1YD')\G

# Query 7: 99.76 QPS, 0.07x concurrency, ID 0x27543A651E60736B50443886E289E35A at byte 32920691
# Scores: V/M = 0.00
# Time range: 2023-09-23T04:09:20 to 2023-09-23T04:10:26
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          2    6584
# Exec time      1      5s    83us    63ms   688us     2ms     2ms   224us
# Lock time      5    24ms       0     3ms     3us     1us    48us     1us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0   6.43k       1       1       1       1       0       1
# Query size     4 983.74k     153     153     153     153       0     153
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  #############
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'unread_announcements'\G
#    SHOW CREATE TABLE `isucholar`.`unread_announcements`\G
UPDATE `unread_announcements` SET `is_deleted` = true WHERE `announcement_id` = '01HB03NA47D89P68WXJ9W15AGZ' AND `user_id` = '01FF6J8XKZ9AW4GDACBKD1NJNW'\G
# Converted for EXPLAIN
# EXPLAIN /*!50100 PARTITIONS*/
select  `is_deleted` = true from `unread_announcements` where  `announcement_id` = '01HB03NA47D89P68WXJ9W15AGZ' AND `user_id` = '01FF6J8XKZ9AW4GDACBKD1NJNW'\G

# Query 8: 28.10 QPS, 0.05x concurrency, ID 0x2BC75A9C3EB65F1EC570DFB4E3F111C5 at byte 37911909
# Scores: V/M = 0.01
# Time range: 2023-09-23T04:09:23 to 2023-09-23T04:10:45
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    2304
# Exec time      1      4s   141us    97ms     2ms     6ms     3ms   725us
# Lock time      3    14ms     1us     2ms     6us     3us    61us     1us
# Rows sent     19  36.29k       0      21   16.13   20.43    8.07   20.43
# Rows examine  13 244.94k       0     688  108.86  313.99  104.84   80.10
# Query size     5   1.34M     611     613  611.18  592.07       0  592.07
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ################################################################
#   1ms  #############################################
#  10ms  ##
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'announcements'\G
#    SHOW CREATE TABLE `isucholar`.`announcements`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'courses'\G
#    SHOW CREATE TABLE `isucholar`.`courses`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'registrations'\G
#    SHOW CREATE TABLE `isucholar`.`registrations`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'unread_announcements'\G
#    SHOW CREATE TABLE `isucholar`.`unread_announcements`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT `announcements`.`id`, `courses`.`id` AS `course_id`, `courses`.`name` AS `course_name`, `announcements`.`title`, NOT `unread_announcements`.`is_deleted` AS `unread` FROM `announcements` JOIN `courses` ON `announcements`.`course_id` = `courses`.`id` JOIN `registrations` ON `courses`.`id` = `registrations`.`course_id` JOIN `unread_announcements` ON `announcements`.`id` = `unread_announcements`.`announcement_id` WHERE 1=1 AND `unread_announcements`.`user_id` = '01FF6J8XWSSX4NYG4DJF8XB5HR' AND `registrations`.`user_id` = '01FF6J8XWSSX4NYG4DJF8XB5HR' ORDER BY `announcements`.`id` DESC LIMIT 21 OFFSET 0\G

# Query 9: 67.64 QPS, 0.06x concurrency, ID 0xAE994A27799DADD410E848351C4DFF53 at byte 45051541
# Scores: V/M = 0.01
# Time range: 2023-09-23T04:09:20 to 2023-09-23T04:10:26
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1    4464
# Exec time      1      4s   102us   108ms   896us     3ms     3ms   273us
# Lock time      4    22ms       0     2ms     4us     1us    53us     1us
# Rows sent      6  11.75k       1       5    2.70    4.96    1.44    1.96
# Rows examine   0  17.17k       1       9    3.94    8.91    2.56    2.90
# Query size     5   1.27M     298     298     298     298       0     298
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ################################################################
#   1ms  ###############
#  10ms  #
# 100ms  #
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'classes'\G
#    SHOW CREATE TABLE `isucholar`.`classes`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'submissions'\G
#    SHOW CREATE TABLE `isucholar`.`submissions`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT `classes`.*, `submissions`.`user_id` IS NOT NULL AS `submitted` FROM `classes` LEFT JOIN `submissions` ON `classes`.`id` = `submissions`.`class_id` AND `submissions`.`user_id` = '01FF6J8XP3ZBKH29JWT2D5R1YD' WHERE `classes`.`course_id` = '01HB03MQWBQJHMA8HHBMND2DRP' ORDER BY `classes`.`part`\G

# Query 10: 99.79 QPS, 0.06x concurrency, ID 0xF16955B9A50074ED04E1B8A511E35989 at byte 29135586
# Scores: V/M = 0.01
# Time range: 2023-09-23T04:09:20 to 2023-09-23T04:10:26
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          2    6586
# Exec time      0      4s    77us    52ms   555us     2ms     2ms   176us
# Lock time      7    35ms     1us     3ms     5us     2us    60us     1us
# Rows sent      3   6.43k       0       1    1.00    0.99    0.02    0.99
# Rows examine   0   6.43k       0       1    1.00    0.99    0.02    0.99
# Query size    13   3.16M     503     503     503     503       0     503
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  ##
# 100us  ################################################################
#   1ms  ########
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'announcements'\G
#    SHOW CREATE TABLE `isucholar`.`announcements`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'courses'\G
#    SHOW CREATE TABLE `isucholar`.`courses`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'unread_announcements'\G
#    SHOW CREATE TABLE `isucholar`.`unread_announcements`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT `announcements`.`id`, `courses`.`id` AS `course_id`, `courses`.`name` AS `course_name`, `announcements`.`title`, `announcements`.`message`, NOT `unread_announcements`.`is_deleted` AS `unread` FROM `announcements` JOIN `courses` ON `courses`.`id` = `announcements`.`course_id` JOIN `unread_announcements` ON `unread_announcements`.`announcement_id` = `announcements`.`id` WHERE `announcements`.`id` = '01HB03N85AXQMQJKQVJ8E7882T' AND `unread_announcements`.`user_id` = '01FF6J8XQ9BH08S3CKH10NBYWE'\G
