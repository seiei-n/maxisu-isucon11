
# 22.5s user time, 90ms system time, 33.08M rss, 40.13M vsz
# Current date: Sat Sep 23 15:01:33 2023
# Hostname: ubuntu
# Files: mysql-slow.log
# Overall: 318.92k total, 79 unique, 3.71k QPS, 4.35x concurrency ________
# Time range: 2023-09-23T05:58:54 to 2023-09-23T06:00:20
# Attribute          total     min     max     avg     95%  stddev  median
# ============     ======= ======= ======= ======= ======= ======= =======
# Exec time           374s     1us      2s     1ms     3ms    12ms    66us
# Lock time          522ms       0   170ms     1us     1us   291us       0
# Rows sent        171.41k       0      50    0.55    0.99    2.94       0
# Rows examine       1.39M       0  14.61k    4.56    0.99  112.79       0
# Query size        23.32M       6 632.12k   76.69  284.79   1.55k   31.70

# Profile
# Rank Query ID                     Response time  Calls  R/Call V/M   Ite
# ==== ============================ ============== ====== ====== ===== ===
#    1 0xFFFCA4D67EA0A788813031B... 282.0826 75.4%  21150 0.0133  0.14 COMMIT
#    2 0xDA556F9115773A1A99AA016...  21.3785  5.7%  92069 0.0002  0.00 ADMIN PREPARE
#    3 0xDAFB520F3EA62E0FD8FCB26...   9.4961  2.5%    369 0.0257  0.50 INSERT courses
#    4 0x98DD1BA507AB79261637698...   4.9701  1.3%   4764 0.0010  0.02 INSERT UPDATE submissions
#    5 0x2BC75A9C3EB65F1EC570DFB...   4.5062  1.2%   2587 0.0017  0.01 SELECT announcements courses registrations unread_announcements
#    6 0x34680D6218DB2F97EAE350D...   4.4403  1.2%   6725 0.0007  0.02 INSERT unread_announcements
#    7 0x27543A651E60736B5044388...   4.3741  1.2%   6429 0.0007  0.01 UPDATE unread_announcements
#    8 0xAE994A27799DADD410E8483...   3.3884  0.9%   4802 0.0007  0.01 SELECT classes submissions
#    9 0xF16955B9A50074ED04E1B8A...   3.1775  0.8%   6431 0.0005  0.01 SELECT announcements courses unread_announcements
#   10 0x1F21068CC7652980263E823...   2.5733  0.7%   2647 0.0010  0.00 SELECT unread_announcements
# MISC 0xMISC                        33.7007  9.0% 170942 0.0002   0.0 <69 ITEMS>

# Query 1: 251.79 QPS, 3.36x concurrency, ID 0xFFFCA4D67EA0A788813031B8BBC3B329 at byte 58839609
# Scores: V/M = 0.14
# Time range: 2023-09-23T05:58:56 to 2023-09-23T06:00:20
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          6   21150
# Exec time     75    282s    13us      2s    13ms    51ms    43ms     4ms
# Lock time      0       0       0       0       0       0       0       0
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size     0 123.93k       6       6       6       6       0       6
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  #########################################
# 100us  ##############
#   1ms  ################################################################
#  10ms  ########################################
# 100ms  #
#    1s  #
#  10s+
COMMIT\G

# Query 2: 1.10k QPS, 0.25x concurrency, ID 0xDA556F9115773A1A99AA0165670CE848 at byte 51607996
# Scores: V/M = 0.00
# Time range: 2023-09-23T05:58:56 to 2023-09-23T06:00:20
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count         28   92069
# Exec time      5     21s    19us    31ms   232us   925us   531us    76us
# Lock time      0       0       0       0       0       0       0       0
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size    11   2.63M      30      30      30      30       0      30
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  ################################################################
# 100us  ####################################
#   1ms  ####
#  10ms  #
# 100ms
#    1s
#  10s+
administrator command: Prepare\G

# Query 3: 5.68 QPS, 0.15x concurrency, ID 0xDAFB520F3EA62E0FD8FCB26DC5D1E62F at byte 58789213
# Scores: V/M = 0.50
# Time range: 2023-09-23T05:58:56 to 2023-09-23T06:00:01
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0     369
# Exec time      2      9s   875us      2s    26ms    53ms   113ms     7ms
# Lock time      0     1ms       0   208us     3us     1us    15us     1us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size     0 151.22k     362     492  419.64  441.81   24.59  400.73
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  #
#   1ms  ################################################################
#  10ms  ##################################
# 100ms
#    1s  #
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'courses'\G
#    SHOW CREATE TABLE `isucholar`.`courses`\G
INSERT INTO `courses` (`id`, `code`, `type`, `name`, `description`, `credit`, `period`, `day_of_week`, `teacher_id`, `keywords`) VALUES ('01HB09YKRVKVYSEYB4JY5T83R4', 'M0108', 'major-subjects', 'ディジタル科学基礎', '本講義では出席を毎回取る。成績は課題の提出状況により判断する。', 2, 1, 'wednesday', '01FF6J8XFS3906KB5YNKHSNQWG', 'ディジタル 科学')\G

# Query 4: 73.29 QPS, 0.08x concurrency, ID 0x98DD1BA507AB79261637698A8004A814 at byte 31225170
# Scores: V/M = 0.02
# Time range: 2023-09-23T05:58:56 to 2023-09-23T06:00:01
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1    4764
# Exec time      1      5s    72us    61ms     1ms     3ms     4ms   194us
# Lock time      3    19ms       0     3ms     3us     1us    60us     1us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size     4   1.04M     202     340  227.96  271.23   28.22  212.52
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  ############
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'submissions'\G
#    SHOW CREATE TABLE `isucholar`.`submissions`\G
INSERT INTO `submissions` (`user_id`, `class_id`, `file_name`) VALUES ('01FF6J8XGH9AKSRDZKD5ZAT7B0', '01HB09XXREJQZQP89CRNZ1Y1P4', '第三回講義_木村 美由紀.pdf') ON DUPLICATE KEY UPDATE `file_name` = VALUES(`file_name`)\G

# Query 5: 31.94 QPS, 0.06x concurrency, ID 0x2BC75A9C3EB65F1EC570DFB4E3F111C5 at byte 44301327
# Scores: V/M = 0.01
# Time range: 2023-09-23T05:58:59 to 2023-09-23T06:00:20
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    2587
# Exec time      1      5s   146us    61ms     2ms     6ms     3ms   761us
# Lock time      2    14ms     1us     1ms     5us     2us    41us     1us
# Rows sent     24  42.57k       0      21   16.85   20.43    7.50   20.43
# Rows examine  21 312.19k       0     635  123.57  441.81  119.79   80.10
# Query size     6   1.51M     611     613  611.14  592.07       0  592.07
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ################################################################
#   1ms  ##############################################
#  10ms  ##
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'announcements'\G
#    SHOW CREATE TABLE `isucholar`.`announcements`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'courses'\G
#    SHOW CREATE TABLE `isucholar`.`courses`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'registrations'\G
#    SHOW CREATE TABLE `isucholar`.`registrations`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'unread_announcements'\G
#    SHOW CREATE TABLE `isucholar`.`unread_announcements`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT `announcements`.`id`, `courses`.`id` AS `course_id`, `courses`.`name` AS `course_name`, `announcements`.`title`, NOT `unread_announcements`.`is_deleted` AS `unread` FROM `announcements` JOIN `courses` ON `announcements`.`course_id` = `courses`.`id` JOIN `registrations` ON `courses`.`id` = `registrations`.`course_id` JOIN `unread_announcements` ON `announcements`.`id` = `unread_announcements`.`announcement_id` WHERE 1=1 AND `unread_announcements`.`user_id` = '01FF6J8XXZVTMF2ARX6HZ7BBQR' AND `registrations`.`user_id` = '01FF6J8XXZVTMF2ARX6HZ7BBQR' ORDER BY `announcements`.`id` DESC LIMIT 21 OFFSET 0\G

# Query 6: 103.46 QPS, 0.07x concurrency, ID 0x34680D6218DB2F97EAE350D366B60E94 at byte 44306087
# Scores: V/M = 0.02
# Time range: 2023-09-23T05:58:56 to 2023-09-23T06:00:01
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          2    6725
# Exec time      1      4s    56us    62ms   660us     1ms     4ms   113us
# Lock time      3    19ms       0     4ms     2us     1us    65us     1us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0       0       0       0       0       0       0       0
# Query size     3 873.46k     133     133     133     133       0     133
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  ############################################
# 100us  ################################################################
#   1ms  ########
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'unread_announcements'\G
#    SHOW CREATE TABLE `isucholar`.`unread_announcements`\G
INSERT INTO `unread_announcements` (`announcement_id`, `user_id`) VALUES ('01HB09Y915AN4BQZZ4BP5ZXVMA', '01FF6J8XGA2AG6KZ1R4J52MJY0')\G

# Query 7: 98.91 QPS, 0.07x concurrency, ID 0x27543A651E60736B50443886E289E35A at byte 44303207
# Scores: V/M = 0.01
# Time range: 2023-09-23T05:58:56 to 2023-09-23T06:00:01
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          2    6429
# Exec time      1      4s    76us    58ms   680us     2ms     2ms   214us
# Lock time      5    28ms       0     2ms     4us     1us    60us     1us
# Rows sent      0       0       0       0       0       0       0       0
# Rows examine   0   6.28k       1       1       1       1       0       1
# Query size     4 960.58k     153     153     153     153       0     153
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  ############
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'unread_announcements'\G
#    SHOW CREATE TABLE `isucholar`.`unread_announcements`\G
UPDATE `unread_announcements` SET `is_deleted` = true WHERE `announcement_id` = '01HB09Y1FTZSNN7XCA33H3P82N' AND `user_id` = '01FF6J8XHX037V9RF0TW19FJ7W'\G
# Converted for EXPLAIN
# EXPLAIN /*!50100 PARTITIONS*/
select  `is_deleted` = true from `unread_announcements` where  `announcement_id` = '01HB09Y1FTZSNN7XCA33H3P82N' AND `user_id` = '01FF6J8XHX037V9RF0TW19FJ7W'\G

# Query 8: 73.88 QPS, 0.05x concurrency, ID 0xAE994A27799DADD410E848351C4DFF53 at byte 46995328
# Scores: V/M = 0.01
# Time range: 2023-09-23T05:58:56 to 2023-09-23T06:00:01
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          1    4802
# Exec time      0      3s   107us    54ms   705us     2ms     2ms   236us
# Lock time      4    22ms       0     2ms     4us     1us    55us     1us
# Rows sent      7  12.66k       1       5    2.70    4.96    1.42    2.90
# Rows examine   1  18.98k       1       9    4.05    8.91    2.61    2.90
# Query size     5   1.36M     298     298     298     298       0     298
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us
# 100us  ################################################################
#   1ms  ############
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'classes'\G
#    SHOW CREATE TABLE `isucholar`.`classes`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'submissions'\G
#    SHOW CREATE TABLE `isucholar`.`submissions`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT `classes`.*, `submissions`.`user_id` IS NOT NULL AS `submitted` FROM `classes` LEFT JOIN `submissions` ON `classes`.`id` = `submissions`.`class_id` AND `submissions`.`user_id` = '01FF6J8XW4YAHKAAJ6F4ZKPFHH' WHERE `classes`.`course_id` = '01HB09XDG4Z17YV9AZPMC96D7J' ORDER BY `classes`.`part`\G

# Query 9: 98.94 QPS, 0.05x concurrency, ID 0xF16955B9A50074ED04E1B8A511E35989 at byte 44300151
# Scores: V/M = 0.01
# Time range: 2023-09-23T05:58:56 to 2023-09-23T06:00:01
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          2    6431
# Exec time      0      3s    70us    55ms   494us     2ms     2ms   159us
# Lock time      6    34ms       0     3ms     5us     2us    62us     1us
# Rows sent      3   6.28k       0       1    1.00    0.99    0.02    0.99
# Rows examine   0   6.28k       0       1    1.00    0.99    0.02    0.99
# Query size    13   3.08M     503     503     503     503       0     503
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  #####
# 100us  ################################################################
#   1ms  ########
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'announcements'\G
#    SHOW CREATE TABLE `isucholar`.`announcements`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'courses'\G
#    SHOW CREATE TABLE `isucholar`.`courses`\G
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'unread_announcements'\G
#    SHOW CREATE TABLE `isucholar`.`unread_announcements`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT `announcements`.`id`, `courses`.`id` AS `course_id`, `courses`.`name` AS `course_name`, `announcements`.`title`, `announcements`.`message`, NOT `unread_announcements`.`is_deleted` AS `unread` FROM `announcements` JOIN `courses` ON `courses`.`id` = `announcements`.`course_id` JOIN `unread_announcements` ON `unread_announcements`.`announcement_id` = `announcements`.`id` WHERE `announcements`.`id` = '01HB09Y8XDW3K72QMA75W230N9' AND `unread_announcements`.`user_id` = '01FF6J8XY6CN37Q3EFAH0A7YC1'\G

# Query 10: 32.68 QPS, 0.03x concurrency, ID 0x1F21068CC7652980263E82315944F5FD at byte 38901545
# Scores: V/M = 0.00
# Time range: 2023-09-23T05:58:59 to 2023-09-23T06:00:20
# Attribute    pct   total     min     max     avg     95%  stddev  median
# ============ === ======= ======= ======= ======= ======= ======= =======
# Count          0    2647
# Exec time      0      3s    78us    59ms   972us     3ms     2ms   366us
# Lock time      1     8ms       0     1ms     3us     1us    35us     1us
# Rows sent      1   2.58k       1       1       1       1       0       1
# Rows examine  10 152.51k       0     127   59.00  112.70   39.91   59.77
# Query size     1 286.93k     111     111     111     111       0     111
# String:
# Databases    isucholar
# Hosts        localhost
# Users        isucon
# Query_time distribution
#   1us
#  10us  #
# 100us  ################################################################
#   1ms  #####################
#  10ms  #
# 100ms
#    1s
#  10s+
# Tables
#    SHOW TABLE STATUS FROM `isucholar` LIKE 'unread_announcements'\G
#    SHOW CREATE TABLE `isucholar`.`unread_announcements`\G
# EXPLAIN /*!50100 PARTITIONS*/
SELECT COUNT(*) FROM `unread_announcements` WHERE `user_id` = '01FF6J8Y2A9XZSME0R0WFNF3N1' AND NOT `is_deleted`\G
